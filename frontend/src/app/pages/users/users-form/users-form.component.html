<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header card-header-tabs card-header-primary">
                                <div class="nav-tabs-navigation">
                                    <div class="nav-tabs-wrapper">


                                        <ul class="nav nav-tabs" data-tabs="tabs" style="float: right;">
                                            <li class="nav-item">
                                                <a mat-button class="nav-link active" (click)="saveUser()" data-toggle="tab">

                                                    <i class="material-icons">save</i> Save & close
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a mat-button class="nav-link active" routerLink="/users" data-toggle="tab">
                                                    <i class="material-icons">view_list</i> Back to List
                                                    <div class="ripple-container"></div>
                                                </a>
                                            </li>
                                        </ul>

                                        <ul class="nav nav-tabs" data-tabs="tabs">
                                            <li class="nav-item">
                                                <i class="material-icons header-mat-icon">edit</i>
                                            </li>
                                            <li class="nav-item" *ngIf="mode === 'edit-record'">
                                                <h4 class="card-title"> Edit user </h4>
                                                <p class="card-category">User: {{userDto?.username}} </p>
                                            </li>
                                            <li class="nav-item" *ngIf="mode === 'new-record'">
                                                <h4 class="card-title"> New user </h4>
                                                <p class="card-category">Create new user </p>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                            </div>
                            <div class="card-body">

                                <br>

                                <div class="row">
                                    <div class="col-md-12">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Username" name="username"
                                                   [(ngModel)]="userDto.username" [disabled]="mode === 'edit-record'">
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Password" type="password" name="password"
                                                   [(ngModel)]="userDto.password" [disabled]="mode === 'edit-record'">
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Email address" type="email" name="email"
                                                   [(ngModel)]="userDto.email">
                                        </mat-form-field>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <span style="color: gray;"> Country </span>
                                        <select class="form-control" id="country" name="country"
                                                [(ngModel)]="userDto?.country.id">
                                            <option value="null"> Select Country</option>
                                            <option value="{{country.id}}"
                                                    *ngFor="let country of countries">{{country.name}}</option>
                                        </select>

                                    </div>
                                </div>

                                <div class="row" style="padding-top: 20px;">
                                    <div class="col-md-4">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Default Market" type="text" name="defaultMarket"
                                                   [(ngModel)]="userDto.defaultMarket">
                                        </mat-form-field>
                                    </div>

                                    <div class="col-md-4">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Markets Access" type="Market" name="market"
                                                   [(ngModel)]="userDto.market">
                                        </mat-form-field>
                                    </div>

                                    <div class="col-md-4">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Landing Page after login" type="Default Market" name="landingPage"
                                                   [(ngModel)]="userDto.landingPage">
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-4">
                                        <mat-form-field class="example-full-width" >
                                            <mat-label>User Group Selection</mat-label>
                                            <mat-select [(value)]="userDto.activeSubstationUserGroupId" >
                                                <!-- <mat-option>None</mat-option> -->
                                                <mat-option *ngFor="let usergroup of userGroups" [value]="usergroup.id">
                                                    {{usergroup.name}}

                                                     (
                                                         <ng-container class="members" *ngFor="let user of usergroup.users let isLast = last" >
                                                            <span>{{user.username}}{{isLast ? '' : ', '}}</span>
                                                    </ng-container>
                                                    )

                                                </mat-option>
                                        </mat-select>
                                        </mat-form-field>
                                    </div>
                                    

                                </div>


                                <br>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="card" [hidden]="mode === 'new-record'">
                            <div class="card-header card-header-tabs card-header-primary">
                                <div class="nav-tabs-navigation">
                                    <div class="nav-tabs-wrapper">

                                        <ul class="nav nav-tabs" data-tabs="tabs" style="float: right;">
                                            <li class="nav-item">
                                                <a mat-button class="nav-link active" (click)="editPassword()">

                                                    <i class="material-icons">save</i> Update
                                                    <div class="ripple-container"></div>

                                                </a>
                                            </li>

                                        </ul>

                                        <ul class="nav nav-tabs" data-tabs="tabs">
                                            <li class="nav-item">
                                                <i class="material-icons header-mat-icon">edit</i>
                                            </li>

                                            <li class="nav-item">
                                                <h4 class="card-title"> Edit Password </h4>
                                                <p class="card-category"> Edit Password </p>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                            </div>

                            <div class="card-body">
                                <br>

                                <div class="row">
                                    <div class="col-md-12">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="New password" type="password" name="password"
                                                   [(ngModel)]="password">
                                        </mat-form-field>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <mat-form-field class="example-full-width">
                                            <input matInput placeholder="Repeat new password" type="password"
                                                   name="passwordRepeat" [(ngModel)]="passwordRepeat">
                                        </mat-form-field>
                                    </div>
                                </div>
                                <br>
                            </div>

                        </div>
                    </div>
                </div>
            </div>



            <div class="col-md-4">


                <div class="card">
                    <div class="card-header card-header-tabs card-header-primary">
                        <div class="nav-tabs-navigation">
                            <div class="nav-tabs-wrapper">


                                <ul class="nav nav-tabs" data-tabs="tabs">
                                    <li class="nav-item">
                                        <i class="material-icons header-mat-icon">vpn_key</i>
                                    </li>

                                    <li class="nav-item">
                                        <h4 class="card-title"> Access rights </h4>
                                        <p class="card-category">  Access rights setup for user </p>
                                    </li>
                                </ul>

                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <br>
                        <div class="row" >

                            <div _ngcontent-mdp-c14="" class="col-md-6">
                                <div class="row">
                                    <div _ngcontent-mdp-c14="" class="col-md-12">
                                        <h6 _ngcontent-mdp-c14=""> Roles crm </h6>
                                    </div>
                                    <div class="col-md-12">
                                        <mat-radio-group (change)="onCrmRoleChange($event)" [(ngModel)]="userDto.rolesCrm" aria-label="Select an option">
                                            <mat-radio-button value="admin">Admin</mat-radio-button>
                                            <br>
                                            <mat-radio-button value="user">User</mat-radio-button><br>
                                            <mat-radio-button value="">None</mat-radio-button>
                                            <br>
                                        </mat-radio-group>
                                    </div>
                                </div>

                            </div>

                            <div _ngcontent-mdp-c14="" class="col-md-6">
                                <div class="row">
                                    <div _ngcontent-mdp-c14="" class="col-md-12">
                                        <h6 _ngcontent-mdp-c14=""> Roles Market </h6>
                                    </div>
                                    <div class="col-md-12">
                                        <mat-radio-group (change)="onMarketRoleChange($event)" [(ngModel)]="userDto.rolesMarket"  aria-label="Select an option">
                                            <mat-radio-button value="admin">Admin</mat-radio-button>
                                            <br>
                                            <mat-radio-button value="user">User</mat-radio-button><br>
                                            <mat-radio-button value="">None</mat-radio-button>
                                            <br>
                                        </mat-radio-group>
                                    </div>
                                </div>

                            </div>


                        </div>

                        <div class="row" style="padding-top: 20px;">

                            <div _ngcontent-mdp-c14="" class="col-md-6">
                                <div class="row">
                                    <div _ngcontent-mdp-c14="" class="col-md-12">
                                        <h6 _ngcontent-mdp-c14=""> Modules crm </h6>
                                    </div>
                                    <div *ngFor="let crmModuleOption of crmModuleOptions" class="col-md-12">
                                        <section class="example-section">
                                            <mat-checkbox class="example-margin" [disabled]="userDto.rolesCrm == '' || crmModuleOption.code==='data' || crmModuleOption.code==='user-groups' ||
                                            crmModuleOption.code === 'notifications' || crmModuleOption.code === 'contacts'" [(ngModel)]="crmModuleOption.selected">{{crmModuleOption.name}}
                                            </mat-checkbox>
                                        </section>
                                    </div>
                                </div>
                                <br>
                            </div>




                            <div _ngcontent-mdp-c14="" class="col-md-6">
                                <div class="row">
                                    <div _ngcontent-mdp-c14="" class="col-md-12">
                                        <h6 _ngcontent-mdp-c14=""> Modules Market </h6>
                                    </div>
                                    <div class="col-md-12" *ngFor="let marketModuleOption of marketModuleOptions" >
                                        <section class="example-section">
                                            <mat-checkbox class="example-margin"  [disabled]="userDto.rolesMarket == '' || marketModuleOption.code==='market' || marketModuleOption.code==='market-stats'|| 
                                            marketModuleOption.code ==='market-notifications' "
                                            [(ngModel)]="marketModuleOption.selected">{{marketModuleOption.name}}
                                            </mat-checkbox>
                                        </section>

                                    </div>
                                </div>

                                <br>
                            </div>
                        </div>
                    </div>


                </div>

            </div>

        </div>


    </div>
</div>
